<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡πÄ‡∏ß‡∏•‡∏≤‡∏à‡∏£‡∏¥‡∏á‡∏Å‡∏±‡∏ö‡πÄ‡∏ß‡∏•‡∏≤‡∏Å‡∏•‡πâ‡∏≠‡∏á</title>
  <style>
    body { font-family: sans-serif; margin: 20px; }
    input { width: 60px; margin: 2px; }
    button { margin: 10px 5px; }
    .section { margin-bottom: 20px; }
    textarea { width: 100%; height: 160px; white-space: pre-wrap; display: none; }
    .credit { font-size: 0.9em; color: gray; margin-top: 10px; }
    #report-section { border: 1px solid #ccc; padding: 10px; width: 100%; max-width: 600px; background: #f9f9f9; }
    #report-text { white-space: pre-wrap; line-height: 1.6; font-family: monospace; }
    #calculate-btn { font-size: 1.1em; padding: 10px 20px; background-color: #007acc; color: white; border: none; border-radius: 5px; }
    #calculate-btn:hover { background-color: #005ea2; cursor: pointer; }
    #extra-buttons { margin-top: 10px; display: none; }
  </style>
</head>
<body>
  <h2>üìπ ‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡πÄ‡∏ß‡∏•‡∏≤‡∏à‡∏£‡∏¥‡∏á‡∏Å‡∏±‡∏ö‡πÄ‡∏ß‡∏•‡∏≤‡∏Å‡∏•‡πâ‡∏≠‡∏á‡∏ß‡∏á‡∏à‡∏£‡∏õ‡∏¥‡∏î</h2>
  <div class="credit">‡∏à‡∏±‡∏î‡∏ó‡∏≥‡πÇ‡∏î‡∏¢ "‡πÅ‡∏°‡∏ß‡∏î‡∏≥ ‡πó üêà‚Äç‚¨õ"</div>

  <div class="section">
    <h4>üì∑ ‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡∏•‡πâ‡∏≠‡∏á</h4>
    <input id="camera_name" type="text" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡∏•‡πâ‡∏≠‡∏á" style="width: 300px;">
  </div>

  <!-- ‡πÄ‡∏ß‡∏•‡∏≤‡∏à‡∏£‡∏¥‡∏á -->
  <div class="section">
    <h4>üïí ‡πÄ‡∏ß‡∏•‡∏≤‡∏à‡∏£‡∏¥‡∏á (‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô)</h4>
    ‡∏ß‡∏±‡∏ô <input id="real_day" type="number"> ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô <input id="real_month" type="number">
    ‡∏õ‡∏µ <input id="real_year" type="number"> ‡πÄ‡∏ß‡∏•‡∏≤
    <input id="real_hour" type="number"> : <input id="real_minute" type="number"> : <input id="real_second" type="number">
  </div>

  <!-- ‡πÄ‡∏ß‡∏•‡∏≤‡πÉ‡∏ô‡∏Å‡∏•‡πâ‡∏≠‡∏á -->
  <div class="section">
    <h4>üì∑ ‡πÄ‡∏ß‡∏•‡∏≤‡πÉ‡∏ô‡∏Å‡∏•‡πâ‡∏≠‡∏á‡∏ß‡∏á‡∏à‡∏£‡∏õ‡∏¥‡∏î</h4>
    ‡∏ß‡∏±‡∏ô <input id="cam_day" type="number"> ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô <input id="cam_month" type="number">
    ‡∏õ‡∏µ <input id="cam_year" type="number"> ‡πÄ‡∏ß‡∏•‡∏≤
    <input id="cam_hour" type="number"> : <input id="cam_minute" type="number"> : <input id="cam_second" type="number">
  </div>

  <!-- ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏î‡∏π‡πÄ‡∏´‡∏ï‡∏∏‡∏Å‡∏≤‡∏£‡∏ì‡πå‡∏¢‡πâ‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏á -->
  <div class="section">
    <h4>üïµÔ∏è ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏î‡∏π‡πÄ‡∏´‡∏ï‡∏∏‡∏Å‡∏≤‡∏£‡∏ì‡πå‡∏à‡∏£‡∏¥‡∏á‡∏¢‡πâ‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏á‡πÄ‡∏°‡∏∑‡πà‡∏≠</h4>
    ‡∏ß‡∏±‡∏ô <input id="target_day" type="number"> ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô <input id="target_month" type="number">
    ‡∏õ‡∏µ <input id="target_year" type="number"> ‡πÄ‡∏ß‡∏•‡∏≤
    <input id="target_hour" type="number"> : <input id="target_minute" type="number"> : <input id="target_second" type="number">
  </div>

  <!-- ‡πÄ‡∏ß‡∏•‡∏≤‡∏Å‡∏•‡πâ‡∏≠‡∏á‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏û‡∏ö‡πÄ‡∏´‡∏ï‡∏∏‡∏Å‡∏≤‡∏£‡∏ì‡πå -->
  <div class="section">
    <h4>üõë ‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡∏Å‡∏•‡πâ‡∏≠‡∏á‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏û‡∏ö‡πÄ‡∏´‡∏ï‡∏∏‡∏Å‡∏≤‡∏£‡∏ì‡πå</h4>
    ‡∏ß‡∏±‡∏ô <input id="event_day" type="number"> ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô <input id="event_month" type="number">
    ‡∏õ‡∏µ <input id="event_year" type="number"> ‡πÄ‡∏ß‡∏•‡∏≤
    <input id="event_hour" type="number"> : <input id="event_minute" type="number"> : <input id="event_second" type="number">
  </div>

  <!-- ‡∏õ‡∏∏‡πà‡∏°‡∏´‡∏•‡∏±‡∏Å -->
  <button id="calculate-btn" onclick="calculate()">‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì</button>
  <button onclick="toggleExtraButtons()">üîß ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°</button>

  <!-- ‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏° -->
  <div id="extra-buttons">
    <button onclick="copyResult()">üìã ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô</button>
    <button onclick="saveAsImage()">üñºÔ∏è ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏†‡∏≤‡∏û</button>
    <button onclick="printReport()">üñ®Ô∏è ‡∏û‡∏¥‡∏°‡∏û‡πå‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô</button>
    <button onclick="clearAllFields()">üßπ ‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
    <button onclick="setNowToAllFields()">üïí ‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ</button>
  </div>

  <!-- ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏ú‡∏• -->
  <div class="section" id="report-section">
    <h4>üìÑ ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì</h4>
    <div id="report-text"></div>
    <textarea id="result" readonly></textarea>
    <div class="credit">‡∏à‡∏±‡∏î‡∏ó‡∏≥‡πÇ‡∏î‡∏¢ "‡πÅ‡∏°‡∏ß‡∏î‡∏≥ ‡πó üêà‚Äç‚¨õ"</div>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script>
    let locationLink = "";

    function toggleExtraButtons() {
      const extra = document.getElementById("extra-buttons");
      extra.style.display = (extra.style.display === "none" || extra.style.display === "") ? "block" : "none";
    }

    function getDateTime(prefix) {
      const d = id => parseInt(document.getElementById(prefix + "_" + id).value) || 0;
      return new Date(d("year"), d("month") - 1, d("day"), d("hour"), d("minute"), d("second"));
    }

    function formatDiff(diff) {
      const abs = Math.abs(diff);
      const sign = diff < 0 ? "‡πÄ‡∏£‡πá‡∏ß" : "‡∏ä‡πâ‡∏≤";
      const d = Math.floor(abs / 86400000);
      const h = Math.floor((abs % 86400000) / 3600000);
      const m = Math.floor((abs % 3600000) / 60000);
      const s = Math.floor((abs % 60000) / 1000);
      return `üìå ‡πÄ‡∏ß‡∏•‡∏≤‡∏Å‡∏•‡πâ‡∏≠‡∏á ${sign}‡∏Å‡∏ß‡πà‡∏≤‡πÄ‡∏ß‡∏•‡∏≤‡∏à‡∏£‡∏¥‡∏á ${d} ‡∏ß‡∏±‡∏ô ${h} ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á ${m} ‡∏ô‡∏≤‡∏ó‡∏µ ${s} ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ`;
    }

    function formatDate(date) {
      return date.toLocaleString("th-TH", {
        year: 'numeric', month: 'long', day: 'numeric',
        hour: '2-digit', minute: '2-digit', second: '2-digit',
        hour12: false
      });
    }

    function calculate() {
      const real = getDateTime("real");
      const cam = getDateTime("cam");
      const target = getDateTime("target");
      const eventCam = getDateTime("event");
      const diff = real - cam;
      const camAtTarget = new Date(target - diff);
      const realAtEvent = new Date(eventCam.getTime() + diff);
      const camName = document.getElementById("camera_name").value || "(‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡∏•‡πâ‡∏≠‡∏á)";

      let report = "üìù ‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÄ‡∏ß‡∏•‡∏≤‡∏Å‡∏•‡πâ‡∏≠‡∏á‡∏ß‡∏á‡∏à‡∏£‡∏õ‡∏¥‡∏î\n";
      report += `üì∑ ‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡∏•‡πâ‡∏≠‡∏á: ${camName}\n\n`;
      report += `üïí ‡πÄ‡∏ß‡∏•‡∏≤‡∏à‡∏£‡∏¥‡∏á (‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô): ${formatDate(real)}\n`;
      report += `üì∑ ‡πÄ‡∏ß‡∏•‡∏≤‡πÉ‡∏ô‡∏Å‡∏•‡πâ‡∏≠‡∏á: ${formatDate(cam)}\n`;
      report += `${formatDiff(diff)}\n\n`;
      report += `üïµÔ∏è ‡∏´‡∏≤‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏î‡∏π‡πÄ‡∏´‡∏ï‡∏∏‡∏Å‡∏≤‡∏£‡∏ì‡πå‡πÄ‡∏°‡∏∑‡πà‡∏≠ ${formatDate(target)}\n`;
      report += `üëâ ‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏õ‡∏¥‡∏î‡∏Å‡∏•‡πâ‡∏≠‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏ß‡∏•‡∏≤: ${formatDate(camAtTarget)}\n\n`;

      if (eventCam.getFullYear() !== 2000 || eventCam.getMonth() !== 0 || eventCam.getDate() !== 1) {
        report += `üìç ‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡∏Å‡∏•‡πâ‡∏≠‡∏á‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏û‡∏ö‡πÄ‡∏´‡∏ï‡∏∏‡∏Å‡∏≤‡∏£‡∏ì‡πå: ${formatDate(eventCam)}\n`;
        report += `üïê ‡πÄ‡∏ß‡∏•‡∏≤‡∏à‡∏£‡∏¥‡∏á‡∏Ç‡∏≠‡∏á‡πÄ‡∏´‡∏ï‡∏∏‡∏Å‡∏≤‡∏£‡∏ì‡πå‡∏ô‡∏±‡πâ‡∏ô‡∏Ñ‡∏∑‡∏≠: ${formatDate(realAtEvent)}\n`;
      }

      report += `\nüìå ‡∏à‡∏±‡∏î‡∏ó‡∏≥‡πÇ‡∏î‡∏¢ \"‡πÅ‡∏°‡∏ß‡∏î‡∏≥ ‡πó üêà‚Äç‚¨õ\"`;
      document.getElementById("result").value = report;
      document.getElementById("report-text").innerText = report;
    }

    function copyResult() {
      const r = document.getElementById("result");
      r.style.display = 'block';
      r.select();
      document.execCommand("copy");
      r.style.display = 'none';
      alert("üìã ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß");
    }


    function saveAsImage() {
      html2canvas(document.getElementById("report-section")).then(canvas => {
        const link = document.createElement('a');
        link.download = "cctv-report.png";
        link.href = canvas.toDataURL();
        link.click();
      });
    }

    function printReport() {
      const content = document.getElementById("report-section").innerHTML;
      const original = document.body.innerHTML;
      document.body.innerHTML = content;
      window.print();
      document.body.innerHTML = original;
      window.location.reload();
    }

    function clearAllFields() {
      ["real", "cam", "target", "event"].forEach(prefix => {
        ["day", "month", "year", "hour", "minute", "second"].forEach(suffix => {
          document.getElementById(`${prefix}_${suffix}`).value = '';
        });
      });
      document.getElementById("camera_name").value = '';
      document.getElementById("report-text").innerText = '';
      document.getElementById("result").value = '';
    }

    
    function setTodayToAllDateFields() {
      const now = new Date();
      const d = now.getDate();
      const m = now.getMonth() + 1;
      const y = now.getFullYear();
      ["real", "cam", "target", "event"].forEach(p => {
        document.getElementById(p + "_day").value = d;
        document.getElementById(p + "_month").value = m;
        document.getElementById(p + "_year").value = y;
      });
    }

    function setNowToAllFields() {
      const now = new Date();
      const d = now.getDate();
      const m = now.getMonth() + 1;
      const y = now.getFullYear();
      const h = now.getHours();
      const min = now.getMinutes();
      const s = now.getSeconds();
      ["real", "cam", "target", "event"].forEach(p => {
        document.getElementById(p + "_day").value = d;
        document.getElementById(p + "_month").value = m;
        document.getElementById(p + "_year").value = y;
        document.getElementById(p + "_hour").value = h;
        document.getElementById(p + "_minute").value = min;
        document.getElementById(p + "_second").value = s;
      });
    }

    window.onload = function () {
      setTodayToAllDateFields();
      getLocation();
    }
  </script>
</body>
</html>
